<!-- templates/users/role_list.html -->
{% extends 'base.html' %}

{% block title %}Role Management - {{ block.super }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Role Management</h1>
            <p class="text-gray-600 mt-1">Manage user roles and their permissions</p>
        </div>
        <a href="{% url 'users:role_create' %}" 
           class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
            Add New Role
        </a>
    </div>

    <!-- Roles Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for role in roles %}
        <div class="bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow">
            <div class="p-6">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h3 class="text-lg font-medium text-gray-900">{{ role.display_name }}</h3>
                        <p class="text-sm text-gray-500 mt-1">@{{ role.name }}</p>
                        {% if role.description %}
                            <p class="text-sm text-gray-600 mt-2">{{ role.description }}</p>
                        {% endif %}
                    </div>
                    {% if role.is_default %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            Default
                        </span>
                    {% endif %}
                </div>

                <!-- Permissions Summary -->
                <div class="mt-4 border-t border-gray-200 pt-4">
                    <h4 class="text-sm font-medium text-gray-900 mb-2">Permissions</h4>
                    <div class="flex flex-wrap gap-1">
                        {% for module, has_access in role.permissions.items %}
                            {% if has_access %}
                                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700">
                                    {% if module == "dashboard" %}Dashboard
                                    {% elif module == "appointments" %}Appointments
                                    {% elif module == "patients" %}Patients
                                    {% elif module == "billing" %}Billing
                                    {% elif module == "reports" %}Reports
                                    {% elif module == "maintenance" %}Maintenance
                                    {% else %}{{ module|title }}
                                    {% endif %}
                                </span>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- User Count -->
                <div class="mt-4 flex items-center text-sm text-gray-500">
                    <svg class="h-4 w-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
                    </svg>
                    {{ role.user_set.count }} user{{ role.user_set.count|pluralize }}
                </div>

                <!-- Actions -->
                <div class="mt-6 flex space-x-3">
                    <a href="{% url 'users:role_detail' role.pk %}" 
                       class="flex-1 text-center bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">
                        View
                    </a>
                    {% if not role.is_default %}
                    <a href="{% url 'users:role_update' role.pk %}" 
                       class="flex-1 text-center bg-primary-600 hover:bg-primary-700 text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">
                        Edit
                    </a>
                    {% else %}
                    <span class="flex-1 text-center bg-gray-300 text-gray-500 px-3 py-2 rounded-md text-sm font-medium cursor-not-allowed">
                        Protected
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-span-full">
            <div class="text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-1">No roles found</h3>
                <p class="text-gray-500 mb-4">Get started by creating your first role.</p>
                <a href="{% url 'users:role_create' %}" 
                   class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                    Add New Role
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Info Box -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-md p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-800">About Roles</h3>
                <div class="mt-2 text-sm text-blue-700">
                    <p>Roles determine what modules and features users can access in the system. Default roles (Admin, Dentist, Staff) are protected and cannot be edited, but you can create custom roles with specific permission combinations.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}